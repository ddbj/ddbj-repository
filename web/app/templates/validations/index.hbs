{{page-title 'Validations'}}

<h1 class="display-6 mb-4">Validations</h1>

<div class="mb-3">
  <LinkTo @route="validations.new" class="btn btn-primary">New Validation</LinkTo>
</div>

<ValidationsSearchForm
  @dbs={{this.dbs}}
  @selectedDBs={{this.selectedDBs}}
  @onSelectedDBsChange={{this.onSelectedDBsChange}}
  @created={{this.created}}
  @onCreatedChange={{this.onCreatedChange}}
  @progresses={{this.progresses}}
  @selectedProgresses={{this.selectedProgresses}}
  @onSelectedProgressesChange={{this.onSelectedProgressesChange}}
  @validities={{this.validities}}
  @selectedValidities={{this.selectedValidities}}
  @onSelectedValiditiesChange={{this.onSelectedValiditiesChange}}
  @submitted={{this.submitted}}
  @onSubmittedChange={{this.onSubmittedChange}}
  class="bg-light p-3 border rounded"
/>

<Table @items={{@model.validations}}>
  <thead class="table-light">
    <tr>
      <th>ID</th>
      <th>DB</th>
      <th>Created</th>
      <th>Started</th>
      <th>Finished</th>
      <th>Progress</th>
      <th>Validity</th>
      <th>Submission</th>
    </tr>
  </thead>

  <tbody>
    {{#each @model.validations key="id" as |validation|}}
      <tr>
        <td class="position-relative">
          <LinkTo @route="validations.show" @model={{validation}} class="stretched-link">
            {{validation.id}}
          </LinkTo>
        </td>

        <td>{{validation.db}}</td>
        <td>{{format-datetime validation.created_at}}</td>

        <td>
          {{#if validation.started_at}}
            {{format-datetime validation.started_at}}
          {{else}}
            -
          {{/if}}
        </td>

        <td>
          {{#if validation.finished_at}}
            {{format-datetime validation.finished_at}}
          {{else}}
            -
          {{/if}}
        </td>

        <td><ProgressLabel @progress={{validation.progress}} /></td>

        <td>
          <ValidityBadge @validity={{validation.validity}} />
          <DetailsCount @results={{validation.results}} />
        </td>

        <td class="position-relative">
          {{#if validation.submission}}
            <LinkTo @route="submissions.show" @model={{validation.submission.id}} class="stretched-link">
              {{validation.submission.id}}
            </LinkTo>
          {{else}}
            -
          {{/if}}
        </td>
      </tr>
    {{/each}}
  </tbody>
</Table>

{{#if (not-eq @model.lastPage 1)}}
  <Pagination @route="validations.index" @current={{this.page}} @last={{@model.lastPage}} />
{{/if}}